name: appflow build

on:
  push:
    branches: [ "main" ]

permissions:
  contents: write

jobs:
  install_cloud_cli_and_trigger_build:
    runs-on: ubuntu-latest
    steps:
      - name: install cloud cli
        run: curl -fsSL https://ionic.io/get-ionic-cloud-cli | bash

      - name: test cloud cli
        run: which ionic-cloud

      - name: invoke build
        id: invoke_build
        run: ionic-cloud build web --app-id=cfe976ed --commit=$GITHUB_SHA --token=${{ secrets.IONIC_TOKEN }} --zip-name=build.zip --json
        
      - name: create release
        id: create_release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # provided by action, you don't need to create this yourself
        with:
          tag_name: $GITHUB_SHA
          name: $GITHUB_SHA
          body: $GITHUB_SHA
          draft: false
          prerelease: false
          files: build.zip
          
